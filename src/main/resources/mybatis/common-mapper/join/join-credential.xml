<?xml version="1.0" encoding="UTF-8"?>
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~
  ~    Copyright (c) 2022 - 2023.
  ~    Haixing Hu, Qubit Co. Ltd.
  ~
  ~    All rights reserved.
  ~
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ltd.qubit.commons.dao.mapper">

  <!--
    关联 credential 表获取 Credential 对象的字段

    == 参数 ==
    alias:              主表的别名；
    type:               主表的实体类型名，必须以 uppercase underscore 风格表示
    property:           主表的实体属性名，必须以 uppercase underscore 风格表示
    credentialAlias:    关联的 credential 表的别名
   -->
  <sql id="joinCredential">
    LEFT JOIN `credential` AS ${credentialAlias}
         ON ${credentialAlias}.`owner_id`                = ${alias}.`id`
        AND ${credentialAlias}.`owner_type`              = '${type}'
        AND ${credentialAlias}.`owner_property`          = '${property}'
        AND ${credentialAlias}.`delete_time` IS NULL     <!-- 限制只能关联未被删除的证件 -->
                                                         <!-- FIXME: 是否应限制 index = 0 以确保只能关联一个证件？ -->
  </sql>

</mapper>
